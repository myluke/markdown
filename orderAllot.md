订单分配 任务分解
===========
## 数据表

### 表1. 订单分配表

`orders_allot`

 一张表 后续做数据归档

### 表2. 订单分配log表

`orders_allot_log_YYYYmmdd`

按照订单发布的时间 按天分表

### 表3. 订单分配操作统计表

`orders_allot_count`

统计订单分配次数 以及 指定定胆的拒绝次数

## 队列

### 1. 订单分配队列

放入需要进行分配计算的订单

### 2. 取消订单关系队列

放入需要需要取消订单关系的订单

## 脚本

### 1. 分配计算脚本

### 2. 扫描超时未被接得订单

进分配队列 重新进行分配计算

### 3. 取消订单关系的脚本

## 场景化说明

### 商户发新订单
新发订单，写入orders表，之后进入订单分配队列，经过分配脚本计算后，分配给符合规则的配送员

改动点：api发单/web后台发单 数据写入订单表后，写入队列即可。

### 配送员刷新可抢订单列表
api返回值分两部分，排在前面的一部分是根据分配规则计算出的可抢订单，后面的部分是按照原来逻辑获取的订单，可按照实际情况逐渐进行过度替换。

改动点：配送员获取可抢订单api，数据源部分变更

### 配送员抢单
抢单动作仍然根据主表的订单状态判定是否抢单成功，如果成功，更新订单状态，写入取消订单关系队列，处理被抢订单分配给其他人的关系记录。
抢单失败，更新自身的订单关系表记录。

改动点：抢单api 根据抢单结果成功与否做后续动作。

### 取消订单
被取消的订单，订单状态在取货前，需要写入取消订单关系队列

### 订单经过分配计算后，状态改变成待接单与待取货的中间态
特殊情况(指定部分配送员接单，需要特殊处理) ？
